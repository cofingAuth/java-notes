

# Java

## JUC 多线程及高并发

### volatitle

volatitle 是 Java 虚拟机提供的轻量级的同步机制

volatitle 具有三大特性：

* 保证可见性
* 不保证原子性
* 禁止指令重排

#### 常见问题

1. 可见性是什么

   查看JVM的JMM内存模型

2. 原子性是什么意思

   不可分割，完整性，即某个线程处理某个业务，中间不可被分割，需要整体完整要么同时完成，要么同时失败

3. 如何解决原子性

   使用synchronized、juc包的Atomic

4. 指令重排

   单线程环境确保最终执行结果和代码顺序执行的结果一致，即指令会按顺序执行不会出现乱序执行

   处理器在进行重排序时必须考虑指令之间的数据依赖性

   多线程环境中线程交替执行，由于编译器优化重排的存在，两个线程中使用的变量能否保证一致性是无法确定的，结果无法预测

5. 你在哪里使用过volatitle

   单例模式（DCL双端检锁）

### CAS

cas 意思是 比较并交换



### 锁

#### 公平锁

指多个线程按照申请锁的顺序来获取锁,类似队列,先进先出

#### 非公平锁

指多个线程获取锁的顺序并不是按照申请锁的顺序，而是看谁先抢占到CPU执行权，谁就先执行，所以有可能会造成优先级反转或者饥饿现象

#### 可重入锁 / 递归锁

指同一个线程对已加锁的资源，可以重复对该资源获取锁

#### 自旋锁

指尝试获取锁的线程不会立即阻塞，而是采用循环的方式去尝试获取锁。这样的好处是减少线程上下文切换的消耗，缺点是循环会消耗CPU

#### 区别与说明

1. ReentrantLock

   通过构造器，可以指定该锁是否为公平锁，默认是非公平锁，非公平锁的优点是吞吐量比公平锁大

2. synchronized

   是非公平锁,可重入锁













# JVM

## JMM

JMM （Java内存模型 Java Memory Model ）是一种抽象的概念并不真实存在，它描述的是一组规则或规范，通过这组规范定义了程序中各个变量（包括实例字段，静态字段和构成数组对象的元素）的访问方式

JMM 关于同步的规定：

* 线程解锁前，必须把共享变量的值刷新回主内存
* 线程加锁前，必须读取主内存的最新值到自己的工作内存
* 加锁解锁是同一把锁

JMM 三个特性规定：

* 可见性
* 原子性
* 有序性

由于JVM运行程序的实体是线程，而每个线程创建时JVM都会为其创建一个工作内存，工作内存是每个线程的私有区域，而Java内存模型中规定所有变量都存储在主内存，主内存是共享内存区域，所有线程都可以访问；不同的线程间无法访问对方的工作内存，线程间的通信必须通过主内存来完成。线程对变量的操作：首先将变量从主内存拷贝到自己的工作内存，然后对变量进行操作，操作完成后再将变量写回主内存。线程对共享变量访问的工作图如下：

![jmm_jgt](./image/all/jmm_jgt.jpg)




